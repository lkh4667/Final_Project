<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="review">

	<!-- 전체 레코드 수 -->
	<select id="count" resultType="int">
		select count(*)
		from review
	</select>

	<!-- 게시글 정렬(최근 글이 위로 올라오도록) -->
	<select id="rv_list" parameterType="dto.PageDTO" resultType="dto.ReviewDTO">
	<![CDATA[
        select b.*
		from (select rownum as rm, a.*
		from (select * 
		from review
		order by rv_num desc)a )b
		where b.rm>=#{startRow} and b.rm<=#{endRow}
	]]>
	</select>
	
	<!-- 조회수 쿼리문 -->
	<update id="readCount" parameterType="int">
		update review set rv_count=rv_count+1
		where rv_num=#{rv_num}
	</update>

	<!-- view 페이지 보여주는 쿼리문 -->
	<select id="content" parameterType="int" resultType="dto.ReviewDTO">
		select *
		from review
		where rv_num=#{rv_num}
	</select>
	
	<!-- 글 등록부분 -->
	<select id="save" parameterType="dto.ReviewDTO">
		insert into review (rv_num, mem_id, rv_title, rv_content, rv_count, rv_regdate)
		values(review_SEQ.nextval, #{mem_id}, #{rv_title}, #{rv_content}, 0, sysdate)
	</select>
	
	<!-- 글 수정부분 -->
	<update id="update" parameterType="dto.ReviewDTO" >
		update review set rv_title=#{rv_title}, rv_content=#{rv_content}, rv_regdate=sysdate
		where rv_num=#{rv_num}	
	</update>
	
	<!-- 글 삭제부분 -->
	<delete id="delete" parameterType="int">
		delete from review
		where rv_num=#{rv_num}
	</delete>
	
	

</mapper>